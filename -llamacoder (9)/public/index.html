<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä - –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –≤–º–µ—Å—Ç–µ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">üí∞</div>
                <h2 class="auth-title">–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä</h2>
                <p class="auth-subtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –≤–º–µ—Å—Ç–µ</p>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="financeAuth.switchAuthTab('login')">–í—Ö–æ–¥</button>
                <button class="auth-tab" onclick="financeAuth.switchAuthTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <!-- Login Form -->
            <form class="auth-form active" id="loginForm" onsubmit="financeAuth.handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">–õ–æ–≥–∏–Ω</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>
                <button type="submit" class="auth-btn" id="loginBtn">
                    <span id="loginBtnText">–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</span>
                </button>
            </form>
            
            <!-- Register Form -->
            <form class="auth-form" id="registerForm" onsubmit="financeAuth.handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">–õ–æ–≥–∏–Ω</label>
                    <input type="text" class="form-input" id="registerUsername" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω" required minlength="3">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="registerEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" id="registerPassword" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" required minlength="6" oninput="financeAuth.checkPasswordRequirements()">
                    <div class="password-requirements">
                        <div class="requirement" id="reqLength">‚óã –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤</div>
                        <div class="requirement" id="reqUpper">‚óã –û–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞</div>
                        <div class="requirement" id="reqNumber">‚óã –û–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input type="password" class="form-input" id="confirmPassword" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                </div>
                <button type="submit" class="auth-btn" id="registerBtn">
                    <span id="registerBtnText">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</span>
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div class="main-app" id="mainApp">
        <div class="container">
            <header>
                <div class="user-menu">
                    <div class="user-info">
                        <span>üë§</span>
                        <span id="currentUserDisplay">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                    </div>
                    <button class="logout-btn" onclick="financeAuth.logout()">–í—ã–π—Ç–∏</button>
                </div>
                <h1>üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä</h1>
                <p class="subtitle">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ —É–º–Ω–æ</p>
            </header>

            <!-- Period Selector -->
            <div class="period-selector">
                <div class="period-title">
                    <span>üìÖ</span> –ü–µ—Ä–∏–æ–¥ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                </div>
                <div class="period-buttons">
                    <button class="period-btn active" data-period="month" onclick="financeAuth.changePeriod('month')">
                        <span>üìÜ</span> –≠—Ç–æ—Ç –º–µ—Å—è—Ü
                    </button>
                    <button class="period-btn" data-period="year" onclick="financeAuth.changePeriod('year')">
                        <span>üìä</span> –≠—Ç–æ—Ç –≥–æ–¥
                    </button>
                    <button class="period-btn" data-period="all" onclick="financeAuth.changePeriod('all')">
                        <span>üìà</span> –í—Å–µ –≤—Ä–µ–º—è
                    </button>
                </div>
                <div class="period-info" id="periodInfo">
                    <span>‚ÑπÔ∏è</span> –ü–æ–∫–∞–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card balance">
                    <div class="stat-title">
                        <span>üí≥</span> –ë–∞–ª–∞–Ω—Å
                    </div>
                    <div class="stat-value" id="balance">‚ÇΩ0</div>
                    <div class="stat-period" id="balancePeriod">–∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</div>
                </div>
                <div class="stat-card income">
                    <div class="stat-title">
                        <span>üìà</span> –î–æ—Ö–æ–¥—ã
                    </div>
                    <div class="stat-value" id="income">‚ÇΩ0</div>
                    <div class="stat-period" id="incomePeriod">–∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</div>
                </div>
                <div class="stat-card expense">
                    <div class="stat-title">
                        <span>üìâ</span> –†–∞—Å—Ö–æ–¥—ã
                    </div>
                    <div class="stat-value" id="expense">‚ÇΩ0</div>
                    <div class="stat-period" id="expensePeriod">–∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</div>
                </div>
            </div>

            <div class="main-grid">
                <div class="card">
                    <h2 class="card-title">
                        <span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                    </h2>
                    <p class="card-description">–ó–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –¥–æ—Ö–æ–¥ –∏–ª–∏ —Ä–∞—Å—Ö–æ–¥</p>
                    <form id="transactionForm" onsubmit="financeAuth.handleAddTransaction(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="type">–¢–∏–ø</label>
                                <select id="type" required onchange="financeAuth.updateCategories()">
                                    <option value="expense">–†–∞—Å—Ö–æ–¥</option>
                                    <option value="income">–î–æ—Ö–æ–¥</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="amount">–°—É–º–º–∞ (‚ÇΩ)</label>
                                <input type="number" id="amount" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="category" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <input type="text" id="description" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ" required>
                        </div>
                        <button type="submit" class="btn">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</button>
                    </form>
                </div>

                <div class="card">
                    <h2 class="card-title">
                        <span>üìä</span> –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    </h2>
                    <p class="card-description" id="transactionsDescription">–í–∞—à–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</p>
                    <div class="transactions-list" id="transactionsList">
                        <div class="empty-state">
                            <div class="empty-icon">üìà</div>
                            <p>–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>
                            <p style="font-size: 0.9rem; margin-top: 8px;">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" id="categoriesCard" style="display: none;">
                <h2 class="card-title">
                    <span>üèÜ</span> –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                </h2>
                <p class="card-description" id="categoriesDescription">–°–∞–º—ã–µ –∫—Ä—É–ø–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</p>
                <div class="categories-grid" id="categoriesGrid"></div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal">
            <div class="modal-icon">‚ö†Ô∏è</div>
            <h3 class="modal-title">–£–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?</h3>
            <p class="modal-description">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –±—É–¥–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±—É–¥–µ—Ç –Ω–∞–≤—Å–µ–≥–¥–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –≤–∞—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏.</p>
            
            <div class="modal-transaction-info" id="modalTransactionInfo">
                <div class="modal-transaction-desc" id="modalTransactionDesc"></div>
                <div class="modal-transaction-meta" id="modalTransactionMeta"></div>
                <div class="modal-transaction-amount" id="modalTransactionAmount"></div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="financeAuth.closeDeleteModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-btn modal-btn-confirm" onclick="financeAuth.confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- Sync Status -->
    <div class="sync-status" id="syncStatus">
        <span class="sync-icon">üîÑ</span>
        <span>–î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã</span>
    </div>

    <script src="auth.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let financeAuth;
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing Finance Auth...');
            financeAuth = new FinanceAuth();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.getElementById('deleteModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    financeAuth.closeDeleteModal();
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ localStorage –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            const users = JSON.parse(localStorage.getItem('financeUsers') || '{}');
            console.log('Existing users:', Object.keys(users));
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ
            if (Object.keys(users).length === 0) {
                console.log('Creating test user...');
                const testUser = {
                    username: 'test',
                    email: 'test@example.com',
                    password: 'Test123',
                    createdAt: new Date().toISOString()
                };
                users.test = testUser;
                localStorage.setItem('financeUsers', JSON.stringify(users));
                localStorage.setItem('transactions_test', JSON.stringify([]));
                console.log('Test user created. Login: test, Password: Test123');
            }
        });
    </script>
</body>
</html>